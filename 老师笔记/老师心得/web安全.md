### XSS攻击

通过伪造script标签



### CSRF攻击



### SQL注入



### TOKEN

1. token也可以称做令牌，一般由 `uid+time+sign(签名)+[固定参数]` 组成

   ```
   uid: 用户唯一身份标识
   time: 当前时间的时间戳
   sign: 签名, 使用 hash/encrypt 压缩成定长的十六进制字符串，以防止第三方恶意拼接
   固定参数(可选): 将一些常用的固定参数加入到 token 中是为了避免重复查库
   ```

2. token在客户端一般存放于localStorage，cookie，或sessionStorage中。在服务器一般存于数据库中

3. token 的认证流程

   ```
   用户登录，成功后服务器返回Token给客户端。
   客户端收到数据后保存在客户端
   客户端再次访问服务器，将token放入headers中 或者每次的请求 参数中
   服务器端采用filter过滤器校验。校验成功则返回请求数据，校验失败则返回错误码
   ```

4. token可以抵抗csrf，cookie+session不行

5. session时有状态的，一般存于服务器内存或硬盘中，当服务器采用分布式或集群时，session就会面对负载均衡问题。负载均衡多服务器的情况，不好确认当前用户是否登录，因为多服务器不共享session

6. 客户端登陆传递信息给服务端，服务端收到后把用户信息加密（token）传给客户端，客户端将token存放于localStroage等容器中。客户端每次访问都传递token，服务端解密token，就知道这个用户是谁了。通过cpu加解密，服务端就不需要存储session占用存储空间，就很好的解决负载均衡多服务器的问题了。这个方法叫做[JWT(Json Web Token)](https://huanqiang.wang/2017/12/28/JWT%20%E4%BB%8B%E7%BB%8D/)

7. JWT就是一个加密的字符串，它由三个部分组成：`header.payload.signature`

   1. `header` 包含了两个部分 `typ` 和 `alg`，分别是声明类型和JWT的加密算法; 经过 `base64` 加密 得到一个字符串
   2. `payload`：负载，存放有效信息的地方。这些有效信息包含三个部分：标准中注册的声明、公共的声明 和 私有的声明。经过 `base64` 加密之后得到 JWT 的第二部分信息
   3. `signature`是一个签名信息，有三个部分组成：`header`、`payload` 和 `secret`
   4. 最后，我们将这三个部分用 `.` 连接成一个完成的字符串就得到了最终的 JWT

8. 请求令牌Token的使用

   1. 放在所有请求头的`x-access-token`中，也可以放在`Aauthoration`中 也可以放在所有请求的请求体body中
   2. 这里服务器创建的令牌就是上文所说的加密的字符串了。

9. Session认证的问题？

   1. HTTP 协议是无状态的，  利用 Cookie 来管理 Session，即把 Session 放入 HTTP 响应中还给客户端，并保存在客户端，当客户端发送下一次请求的时候，就把这个 Session 一起发送回来，这样就能这次的请求是谁发出来的了
   2. 内存开销大： Session 是存在服务器上的，实际上为了加快认证的速度，我们一般都会放在内存中，这样当用户基数大的时候，内存的开销就会很大。当然也可以将 Session 存入到 Session 表或者是缓存（redis等）中，但是依旧会有这样的问题。
   3. 安全性（CSRF）： 因为是基于 Cookie 进行用户识别，如果 Cookie 被截获，用户就会很容易收到跨站请求伪造的攻击。
   4. 分布式：因为 Session 信息是被单个服务器所保存的，所以在分布式系统中就不能适用了。比如 Session 一开始是保存在 A 服务器上，但是下一次请求的时候，这个请求被服务器负载均衡转发到了 B 服务器，而 B 服务器则没有这个 Session 信息，所以就不能用过认证了； （现在这个分布式下的 Session 管理问题，也有很多的解决方案，这里不讨论）

10. JWT的解决方案

    1. JWT轻量级，传输方式可以通过`URL`/`POST参数`/`HTTP头部`等方式传输、
    2. 对于长久的token， 建议每个一段时间就更新 `Token`，即对 JWT 设置一个有效时间，并返回一个新的 `Token` 给客户端，客户端再更新 `Token`。对于旧的 `Token`，服务器将其加入黑名单

